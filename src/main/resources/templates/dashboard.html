<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base::layout(~{::section})}">

<section class="container-fluid px-4 mt-3">
	<link rel="stylesheet" th:href="@{/css/common.css}">

	<div class="page-header">
		<h4 class="mb-0">Dashboard Overview</h4>
		<div class="text-muted small">
			<i class="fas fa-calendar-alt me-1"></i>
			<span th:text="${#temporals.format(#temporals.createNow(), 'dd MMMM yyyy')}"></span>
		</div>
	</div>

	<div class="row g-4 mb-4">
		<div class="col-xl-3 col-md-6" th:each="stat : ${stats}">
			<div class="card custom-card border-0 p-3 shadow-sm">
				<div class="d-flex justify-content-between align-items-start">
					<div>
						<p class="text-muted small text-uppercase fw-bold mb-1" th:text="${stat.label}"></p>
						<h3 class="fw-bold mb-1" th:text="${stat.value}"></h3>
						<span class="badge bg-soft-success text-success p-1 px-2" style="font-size: 0.7rem;">
                      <i class="fas fa-chart-line me-1"></i> <span th:text="${stat.sub}"></span>
                   </span>
					</div>
					<div class="icon-box shadow-sm d-flex align-items-center justify-content-center"
					     th:classappend="${stat.bg}"
					     style="width: 48px; height: 48px; border-radius: 12px; flex-shrink: 0;">
						<i th:class="${stat.icon}" style="font-size: 1.25rem;"></i>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row g-4 mb-4">
		<div class="col-xl-3 col-md-6">
			<div class="card custom-card h-100 shadow-sm border-0" style="border-top: 3px solid #0d6efd !important;">
				<div class="card-header bg-transparent border-0 pt-3 d-flex justify-content-between align-items-center">
					<h6 class="fw-bold mb-0 text-muted small text-uppercase">Total Revenue</h6>
					<i class="fas fa-hand-holding-usd text-success"></i>
				</div>
				<div class="card-body pt-0">
					<h3 class="fw-bold mb-1" th:text="${currencySymbol + ' ' + #numbers.formatDecimal(totalRevenue, 1, 2)}"></h3>
					<span class="badge bg-soft-success text-success" style="font-size: 0.7rem;">Lifetime Earnings</span>
				</div>
			</div>
		</div>

		<div class="col-xl-3 col-md-6">
			<div class="card custom-card h-100 shadow-sm border-0" style="border-top: 3px solid #0d6efd !important;">
				<div class="card-header bg-transparent border-0 pt-3 d-flex justify-content-between align-items-center">
					<h6 class="fw-bold mb-0 text-muted small text-uppercase">Total Cost</h6>
					<i class="fas fa-shopping-cart text-danger"></i>
				</div>
				<div class="card-body pt-0">
					<h3 class="fw-bold mb-1" th:text="${currencySymbol + ' ' + #numbers.formatDecimal(totalCost, 1, 2)}"></h3>
					<span class="badge bg-soft-danger text-danger" style="font-size: 0.7rem;">Approved Orders</span>
				</div>
			</div>
		</div>

		<div class="col-xl-3 col-md-6">
			<div class="card custom-card h-100 shadow-sm border-0" style="border-top: 3px solid #0d6efd !important;">
				<div class="card-header bg-transparent border-0 pt-3 d-flex justify-content-between align-items-center">
					<h6 class="fw-bold mb-0 text-muted small text-uppercase">Total Meds</h6>
					<i class="fas fa-pills text-info"></i>
				</div>
				<div class="card-body pt-0">
					<h3 class="fw-bold mb-1" th:text="${totalMeds}"></h3>
					<span class="badge bg-soft-info text-info" style="font-size: 0.7rem;">Inventory Count</span>
				</div>
			</div>
		</div>

		<div class="col-xl-3 col-md-6">
			<div class="card custom-card h-100 shadow-sm border-0" style="border-top: 3px solid #0d6efd !important;">
				<div class="card-header bg-transparent border-0 pt-3 d-flex justify-content-between align-items-center">
					<h6 class="fw-bold mb-0 text-muted small text-uppercase">Categories</h6>
					<i class="fas fa-tags text-warning"></i>
				</div>
				<div class="card-body pt-0">
					<h3 class="fw-bold mb-1" th:text="${totalCategories}"></h3>
					<span class="badge bg-soft-warning text-warning" style="font-size: 0.7rem;">Stock Groups</span>
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-12">
			<div class="card custom-card">
				<div class="card-header bg-transparent border-0 pt-3 d-flex justify-content-between align-items-center">
					<h6 class="fw-bold mb-0 text-primary">
						<i class="fas fa-microchip me-2"></i>Inventory Reorder Point (ROP)
					</h6>
					<small class="text-muted">Algorithm: (Daily Demand Ã— Lead Time) + Safety Stock</small>
				</div>
				<div class="card-body p-0"> <div class="table-responsive">
					<table class="table table-hover align-middle mb-0">
						<thead class="table-light">
						<tr class="small text-uppercase text-muted">
							<th class="ps-4">Medicine</th> <th>Current Stock</th>
							<th title="Demand forecast for the next 30 days">Monthly Forecast</th>
							<th>Lead Time</th>
							<th>Target ROP</th>
							<th>Stock Cover</th> <th>Status</th>
							<th class="pe-4 text-end">Soonest Expiry</th>
						</tr>
						</thead>
						<tbody>
						<tr th:each="med : ${reorderAdvice}">
							<td class="ps-4">
								<div class="fw-bold" th:text="${med.name}"></div>
								<span class="badge bg-light text-dark fw-normal" style="font-size: 0.7rem;" th:text="${med.manufacturer}"></span>
							</td>
							<td>
								<span class="fs-6 fw-bold" th:text="${med.qty}"></span>
								<small class="text-muted" th:text="${med.qtyUnit}"></small>
							</td>
							<td th:text="${#numbers.formatDecimal(med.lastForecast, 1, 1)}"></td>
							<td>
								<span th:text="${med.leadTime}"></span> <small>days</small>
							</td>
							<td>
                           <span class="badge bg-soft-info text-info"
                                 th:text="${#numbers.formatDecimal(med.getCalculatedROP(), 1, 0)}"></span>
							</td>
							<td>
                           <span class="small fw-bold"
                                 th:classappend="${(med.qty / (med.getDailyDemand() ?: 1)) < 7 ? 'text-danger' : 'text-success'}"
                                 th:text="${#numbers.formatDecimal(med.qty / (med.getDailyDemand() ?: 1), 1, 0) + ' Days'}">
                           </span>
							</td>
							<td>
                           <span th:if="${med.qty <= med.getCalculatedROP()}" class="badge bg-danger">
                               <i class="fas fa-exclamation-triangle me-1"></i> REORDER
                           </span>
								<span th:if="${med.qty > med.getCalculatedROP()}" class="badge bg-success">STABLE</span>
							</td>
							<td class="pe-4 text-end" th:classappend="${med.getInventoryStatus() == 'EXPIRY_SOON' ? 'text-warning' : ''}">
								<i class="far fa-calendar-alt me-1 text-muted"></i>
								<small th:text="${med.getSoonestExpiryDate() != null ? #temporals.format(med.getSoonestExpiryDate(), 'dd MMM yyyy') : 'No Batches'}"></small>
							</td>
						</tr>
						<tr th:if="${#lists.isEmpty(reorderAdvice)}">
							<td colspan="8" class="text-center py-5">
								<i class="fas fa-check-circle text-success fa-3x mb-3"></i>
								<p class="text-muted">All inventory levels are optimal.</p>
							</td>
						</tr>
						</tbody>
					</table>
				</div>
				</div>
			</div>
		</div>
	</div>
</section>
</html>