<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base::layout(~{::section})}">

<head>
	<meta charset="UTF-8">
	<title>Medicine Management</title>
</head>

<body>
<section class="container-fluid px-4 mt-3">
	<link rel="stylesheet" th:href="@{/css/common.css}">

	<div class="page-header">
		<h4 class="mb-0">ðŸ’Š Medicine Management</h4>
		<button class="btn btn-primary shadow-sm" onclick="openMedicineModal()">
			<i class="fas fa-plus-circle me-1"></i> Add Medicine
		</button>
	</div>

	<div class="row mb-4">
		<div class="col-md-4 ms-auto">
			<div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                    <i class="fas fa-search text-muted"></i>
                </span>
				<input type="text" id="medicineSearch" class="form-control border-start-0"
				       placeholder="Search medicine ID or Name...">
			</div>
		</div>
	</div>

	<div class="card custom-card">
		<div class="card-body p-0">
			<div class="table-responsive">
				<table class="table table-hover table-custom mb-0" id="medicineTable">
					<thead>
					<tr>
						<th>ID</th>
						<th>Name</th>
						<th>Category</th>
						<th>Price</th>
						<th>Quantity</th>
						<th>Expiry</th>
						<th>Status</th>
						<th class="text-center">Actions</th>
					</tr>
					</thead>
					<tbody>
					<tr th:each="medicine : ${medicines}" th:attr="data-id=${medicine.id}">
						<td class="td-id" th:text="${medicine.id}"></td>
						<td class="td-name">
							<span th:text="${medicine.name}"></span><br>
							<small class="td-manufacturer text-muted" th:text="${medicine.manufacturer}"></small>
						</td>
						<td class="td-category" th:text="${medicine.category.name}"></td>
						<td class="td-price" th:text="${#numbers.formatDecimal(medicine.price, 1, 2)}"></td>
						<td class="td-qty">
							<span th:text="${medicine.qty}"></span>
							<small class="text-muted" th:text="${medicine.qtyUnit}"></small>
							<i th:if="${medicine.inventoryStatus == 'LOW_STOCK'}"
							   class="fas fa-exclamation-triangle text-warning ms-1" title="Low Stock"></i>
						</td>
						<td class="td-expDate"
						    th:text="${medicine.soonestExpiryDate != null ? medicine.soonestExpiryDate : 'N/A'}"
						    th:classappend="${medicine.inventoryStatus == 'EXPIRED' ? 'text-danger fw-bold' : ''}">
						</td>
						<td class="td-status">
							<div th:switch="${medicine.inventoryStatus}">
								<span th:case="'NORMAL'" class="badge status-badge bg-success">Normal</span>
								<span th:case="'LOW_STOCK'" class="badge status-badge bg-warning text-dark">Low Stock</span>
								<span th:case="'EXPIRY_SOON'" class="badge status-badge bg-danger">Expiring Soon</span>
								<span th:case="'OUT_OF_STOCK'" class="badge status-badge bg-secondary">Out of Stock</span>
								<span th:case="'EXPIRED'" class="badge status-badge bg-dark">Expired</span>
							</div>
						</td>
						<td class="text-center">
							<div class="btn-group" role="group">
								<button type="button"
								        class="btn btn-sm btn-outline-info"
								        title="View Details"
								        onclick="viewMedicineDetails(this.closest('tr'))">
									<i class="fas fa-eye"></i>
								</button>

								<button class="btn btn-sm btn-outline-warning"
								        title="Edit Medicine"
								        onclick="openEditMedicineModal(this.closest('tr').dataset.id)">
									<i class="fas fa-edit"></i>
								</button>
								<a th:href="@{/medicine/delete/{id}(id=${medicine.id})}"
								   class="btn btn-sm btn-outline-danger"
								   title="Delete Medicine"
								   onclick="return confirm('Delete this medicine?')">
									<i class="fas fa-trash"></i>
								</a>
							</div>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<div th:replace="~{modal/add-medicine-modal :: modal}"></div>
</section>
</body>
</html>
