<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base::layout(~{::section})}">

<head>
	<meta charset="UTF-8">
	<title>Medicine Management</title>
</head>

<body>
<section>

	<div class="container-fluid px-4 mt-3">

		<!-- Header -->
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h4 class="mb-0">ðŸ’Š Medicine Management</h4>

		</div>

		<!-- Search Bar -->
		<div class="row mb-3">
			<div class="col-md-4 ms-auto">
				<input type="text"
					   class="form-control"
					   placeholder="ðŸ” Search medicine..."
					   id="medicineSearch">
			</div>
		</div>

		<!-- Table -->
		<div class="card shadow-sm">
			<div class="card-body table-responsive">
				<table class="table table-bordered table-hover align-middle" id="medicineTable">
					<thead class="table-dark">
					<tr>
						<th>ID</th>
						<th>Name</th>
						<th>Description</th>
						<th>Category</th>
						<th>Price</th>
						<th>Quantity</th>
						<th>Unit</th>
						<th>Location</th>
						<th>Manufacturer</th>
						<th>Soonest EXP</th>
						<th>Alert Status</th>
						<th class="text-center">Actions</th>
					</tr>
					</thead>

					<tbody>
					<tr th:each="medicine : ${medicines}" th:attr="data-id=${medicine.id}">
						<td class="td-id" th:text="${medicine.id}"></td>
						<td class="td-name" th:text="${medicine.name}"></td>
						<td class="td-desc" th:text="${medicine.description}"></td>
						<td class="td-category" th:text="${medicine.category.name}"></td>
						<td class="td-price" th:text="${medicine.price}"></td>

						<td class="td-qty">
							<span th:text="${medicine.qty}"></span>
							<i th:if="${medicine.inventoryStatus == 'LOW_STOCK'}"
							   class="fas fa-exclamation-triangle text-warning" title="Low Stock"></i>
						</td>

						<td class="td-qtyUnit" th:text="${medicine.qtyUnit}"></td>
						<td class="td-location" th:text="${medicine.location}"></td>
						<td class="td-manufacturer" th:text="${medicine.manufacturer}"></td>

						<td class="td-expDate"
							th:text="${medicine.soonestExpiryDate != null ? medicine.soonestExpiryDate : 'N/A'}"
							th:classappend="${medicine.inventoryStatus == 'EXPIRED' ? 'text-danger fw-bold' : ''}">
						</td>

						<td>
							<div th:switch="${medicine.inventoryStatus}">
								<span th:case="'OUT_OF_STOCK'" class="badge bg-secondary">Out of Stock</span>
								<span th:case="'EXPIRED'" class="badge bg-dark">Expired</span>
								<span th:case="'EXPIRY_SOON'" class="badge bg-danger">Expiring Soon</span>
								<span th:case="'LOW_STOCK'" class="badge bg-warning text-dark">Low Stock</span>
								<span th:case="'NORMAL'" class="badge bg-success">Healthy</span>
							</div>
						</td>

						<td class="text-center">
							<button type="button"
									class="btn btn-sm btn-warning me-1"
									th:attr="onclick=${'openEditMedicineModal('+ medicine.id +')'}">
								Edit
							</button>
							<a th:href="@{/medicine/delete/{id}(id=${medicine.id})}"
							   class="btn btn-sm btn-danger"
							   onclick="return confirm('Delete this medicine?')">
								Delete
							</a>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>

	</div>

	<!-- Simple Client-Side Search -->
	<script>
        document.getElementById("medicineSearch").addEventListener("keyup", function () {
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll("#medicineTable tbody tr");

            rows.forEach(row => {
                let idCell = row.cells[0];   // ID column
                let nameCell = row.cells[1]; // Name column

                // Check if either ID or Name includes the filter
                let matches = idCell.textContent.toLowerCase().includes(filter) ||
                    nameCell.textContent.toLowerCase().includes(filter);

                row.style.display = matches ? "" : "none";
            });
        });

	</script>

	<div th:replace="~{modal/add-medicine-modal :: modal}"></div>

</section>
</body>
</html>
